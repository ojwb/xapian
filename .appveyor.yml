skip_tags: true
clone_depth: 20
clone_folder: c:\projects\xapian
environment:
  global:
    AUTOMATED_TESTING: 1
  matrix:
  - TOOLCHAIN: mingw64
    platform: x64
install:
  - ps: >-
      $env:CONFIGOPTS="--disable-documentation"
  - ps: >-
      $env:PATH="C:\mingw-w64\x86_64-7.2.0-posix-seh-rt_v5-rev1\mingw64\bin;C:\msys64\usr\bin;$env:PATH"
  - ps: >-
      $env:CONFIGOPTS+=" --host=x86_64-w64-mingw32"
  - bash -c 'rm -rf /var/lib/pacman/sync/* /etc/pacman.d/gnupg'
  - bash -c 'pacman-key --init'
  - bash -c 'pacman-key --populate msys2'
  - bash -c 'curl -O https://repo.msys2.org/msys/x86_64/msys2-keyring-r21.b39fb11-1-any.pkg.tar.xz'
  - bash -c 'curl -O https://repo.msys2.org/msys/x86_64/msys2-keyring-r21.b39fb11-1-any.pkg.tar.xz.sig'
  - bash -c 'touch dummy'
  - bash -c 'ls -l'
  - bash -c 'pacman -U --noconfirm --config dummy msys2-keyring-r21.b39fb11-1-any.pkg.tar.xz'
  - bash -c 'pacman -Syyu || pacman -Syyu'
  - bash -c 'pacman -Sy --noconfirm --needed base-devel doxygen mingw-w64-x86_64-toolchain mingw-w64-x86_64-doxygen mingw-w64-x86_64-python-pip mingw-w64-x86_64-graphviz zlib-devel'
  - bash -c 'time ./bootstrap --download-tools=never --fetch-url-command="curl -L" xapian-core'
build_script:
  - bash -c 'time ./configure $CONFIGOPTS --disable-backend-honey --with-go'
test_script:
  - bash -c 'echo dummy'

